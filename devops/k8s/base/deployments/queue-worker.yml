apiVersion: apps/v1
kind: Deployment
metadata:
  name: queue-worker
spec:
  replicas: 1
  selector:
    matchLabels:
      app: queue-worker
  template:
    metadata:
      labels:
        app: queue-worker
        commit-short-sha: "commit_${DEPLOY_COMMIT_SHORT_SHA}"
    spec:
      restartPolicy: Always
      imagePullSecrets:
       - name: hamdocker
      containers:
        - image: registry.hamdocker.ir/paylibero/queue-worker
          name: queue-worker
          command:
            - php
          args:
            - artisan
            - queue:work
            - --tries=3
            - --backoff=5
          ports:
            - containerPort: 8000
              protocol: TCP
          resources: {}
          env:
            - name: APP_NAME
              value: Laravel
            - name: APP_ENV
              value: production
            - name: DB_PORT
              value: '3306'
            - name: APP_KEY
              value: "ggrz5rUpSYczpc"
            - name: APP_DEBUG
              value: 'false'
            - name: APP_URL
              value: https://core-lara-33e1254e7d-paylibero-nightly.apps.ir-thr-ba1.arvancaas.ir
            - name: LOG_CHANNEL
              value: stack
            - name: LOG_DEPRECATIONS_CHANNEL
              value: 'null'
            - name:  LOG_LEVEL 
              value: debug
            - name: DB_CONNECTION
              value: mysql
            - name: DB_HOST
              value: paylibero-db-mysql-headless
            - name: DB_DATABASE
              value: laravel
            - name: MYSQL_DATABASE
              value: laravel
            - name: BROADCAST_DRIVER
              value: log
            - name: CACHE_DRIVER
              value: file
            - name: FILESYSTEM_DISK
              value: local
            - name: QUEUE_CONNECTION
              value: sync
            - name: SESSION_DRIVER
              value: file
            - name: SESSION_LIFETIME
              value: '120'
            - name: MEMCACHED_HOST
              value: '127.0.0.1'
            - name: REDIS_PORT
              value: '6379'
            - name: RUN_SETUP_COMMANDS
              value: 'false'