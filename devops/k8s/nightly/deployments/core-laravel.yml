apiVersion: apps/v1
kind: Deployment
metadata:
  name: core-laravel
spec:
  replicas: 1
  template:
    spec:
      initContainers:
        - name: laravel-setup
          env:
            # APP--------------------------------------
            - name: APP_ENV
              value: nightly
            - name: APP_URL
              value: https://nightly.paylibero.ir
            # DB--------------------------------------
            - name: DB_HOST
              value: paylibero-db-mysql-headless
            - name: DB_PORT
              value: "3306"
            - name: DB_USERNAME
              valueFrom:
                secretKeyRef:
                  name: core-laravel-mysql-db
                  key: username
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: core-laravel-mysql-db
                  key: password

            # RECAPTCHA--------------------------------------
            - name: RECAPTCHA_V3_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: google-recaptcha
                  key: secret_key
            - name: RECAPTCHA_V3_SITE_KEY
              valueFrom:
                secretKeyRef:
                  name: google-recaptcha
                  key: site_key
            - name: RECAPTCHA_V3_ENABLE
              value: "false"

            # REDIS--------------------------------------
            - name: REDIS_HOST
              value: redis
            - name: REDIS_PORT
              value: "6379"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: redis-auth
                  key: redis-password

            # MAIL--------------------------------------
            - name: MAIL_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: najva
                  key: password
            # ZIBAL_CALLBACK_URL--------------------------------------
            - name: ZIBAL_CALLBACK_URL
              value: https://nightly.paylibero.ir/api/gateway/callback
            # FINNOTECH--------------------------------------
            - name: FINNOTECH_BASE_URL
              value: https://sandboxapi.finnotech.ir
            - name: FINNOTECH_CLIENT_ID
              value: paylibero
            - name: FINNOTECH_TOKEN
              value: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbklkIjoiZDQwZWVmZTctNjQzYy00YTQ3LThmODItYzA5MjMyOGE1ZDQyIiwicmVmcmVzaFRva2VuIjoiakZWdXhTSmo1MElCRlYwbEgyOWZnemtqOTQ4d3kzTm94R2NKU1dwNUFvVXpmcDNzTlJxSTZ2RU04M2M2SFk2V2IzSGo5UHVDV1JDQnlzMDRzTmxtblZyOEVBMWYwaGd1NUozQTVzeGMxcGxSN1lWZ2RuYThycnZQdVVyUWYyODlVOEhSVEVFcHF1Vkx4bHRaNW1MZm5DdHZLbEFDY0dGZFkwMDFKVmptUkVHNUNtNVlmNmRFSkhnRVhhVU1KUGZDamx6Nk9mbUVTdWY4VHN1NzN2R3R1djcwYkhwYWd5OEFRWGJuR3RsN1gxVWFmbTJReTRQT2NONVducE5jMmQxYiIsImNyZWF0aW9uRGF0ZSI6IjE0MDMwNjEwMTE1MDExIiwibGlmZVRpbWUiOjg2NDAwMDAwMCwiY2xpZW50SWQiOiJwYXlsaWJlcm8iLCJ1c2VySWQiOiI0Mjg1Nzg3NjUyIiwiYWN0aXZlIjp0cnVlLCJzY29wZXMiOlsiZmFjaWxpdHk6Y2FyZC10by1pYmFuOmdldCJdLCJ0eXBlIjoiQ0xJRU5ULUNSRURFTlRJQUwiLCJjbGllbnRJbmZvIjoid20zNGFMY2dDQitIT2UxZlN1eFNmWmdNWjB0RHc0UzVRVXYxakNNTyIsImJhbmsiOiIwNjIiLCJpYXQiOjE3MjUwODg4MTEsImV4cCI6MTcyNTk1MjgxMX0.pFYJvkj08QBfMXTgsfkSzIpHF3zNQITW82haZmKLNTv5ClVzlzNs2gV5BU6CpAxMbgjPQljAqXtmcPh5Y6r7Z3OyAo2Owm6kxNwBVGC8Wp5c5ZOzHvY9KRf-pD_eoYOcZU8_OWxUDY14TTEyQ56qJmAcJkey-3izSP-tqIPJp-ACp43rTG8K6zI1G4gwuRCZiVGF9mvCRDinHS-jqOiQWElmTgu0M5uyKJdfm8BIgbluYyvO6WYZNgF64VaUDfcZYJtxmh7IDAW5_Hc-l9YVPMpTSVhOWHk4V6I7sB5LgkDUV5qAEFya3REcwh4j0E7XYn9hw8aPiYhyZTukbG025Q
            - name: FRONTEND_URL_AFTER_PAYMENT
              value: https://nightly.paylibero.ir/dashboard/trades

      containers:
        - name: core-laravel
          resources:
            limits:
              cpu: 500m
              ephemeral-storage: 200M
              memory: 1G
            requests:
              cpu: 500m
              ephemeral-storage: 200M
              memory: 1G

          env:
            # APP--------------------------------------
            - name: APP_ENV
              value: nightly
            - name: APP_URL
              value: https://nightly.paylibero.ir
            # DB--------------------------------------
            - name: DB_HOST
              value: paylibero-db-mysql-headless
            - name: DB_PORT
              value: "3306"
            - name: DB_USERNAME
              valueFrom:
                secretKeyRef:
                  name: core-laravel-mysql-db
                  key: username
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: core-laravel-mysql-db
                  key: password

            # RECAPTCHA--------------------------------------
            - name: RECAPTCHA_V3_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: google-recaptcha
                  key: secret_key
            - name: RECAPTCHA_V3_SITE_KEY
              valueFrom:
                secretKeyRef:
                  name: google-recaptcha
                  key: site_key
            - name: RECAPTCHA_V3_ENABLE
              value: "false"

            # REDIS--------------------------------------
            - name: REDIS_HOST
              value: redis
            - name: REDIS_PORT
              value: "6379"
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: redis-auth
                  key: redis-password

            # MAIL--------------------------------------
            - name: MAIL_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: ahasend
                  key: password
            # ZIBAL_CALLBACK_URL--------------------------------------
            - name: ZIBAL_CALLBACK_URL
              value: https://nightly.paylibero.ir/api/gateway/callback
            # FINNOTECH--------------------------------------
            - name: FINNOTECH_BASE_URL
              value: https://sandboxapi.finnotech.ir
            - name: FINNOTECH_CLIENT_ID
              value: paylibero
            - name: FINNOTECH_TOKEN
              value: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbklkIjoiZDQwZWVmZTctNjQzYy00YTQ3LThmODItYzA5MjMyOGE1ZDQyIiwicmVmcmVzaFRva2VuIjoiakZWdXhTSmo1MElCRlYwbEgyOWZnemtqOTQ4d3kzTm94R2NKU1dwNUFvVXpmcDNzTlJxSTZ2RU04M2M2SFk2V2IzSGo5UHVDV1JDQnlzMDRzTmxtblZyOEVBMWYwaGd1NUozQTVzeGMxcGxSN1lWZ2RuYThycnZQdVVyUWYyODlVOEhSVEVFcHF1Vkx4bHRaNW1MZm5DdHZLbEFDY0dGZFkwMDFKVmptUkVHNUNtNVlmNmRFSkhnRVhhVU1KUGZDamx6Nk9mbUVTdWY4VHN1NzN2R3R1djcwYkhwYWd5OEFRWGJuR3RsN1gxVWFmbTJReTRQT2NONVducE5jMmQxYiIsImNyZWF0aW9uRGF0ZSI6IjE0MDMwNjEwMTE1MDExIiwibGlmZVRpbWUiOjg2NDAwMDAwMCwiY2xpZW50SWQiOiJwYXlsaWJlcm8iLCJ1c2VySWQiOiI0Mjg1Nzg3NjUyIiwiYWN0aXZlIjp0cnVlLCJzY29wZXMiOlsiZmFjaWxpdHk6Y2FyZC10by1pYmFuOmdldCJdLCJ0eXBlIjoiQ0xJRU5ULUNSRURFTlRJQUwiLCJjbGllbnRJbmZvIjoid20zNGFMY2dDQitIT2UxZlN1eFNmWmdNWjB0RHc0UzVRVXYxakNNTyIsImJhbmsiOiIwNjIiLCJpYXQiOjE3MjUwODg4MTEsImV4cCI6MTcyNTk1MjgxMX0.pFYJvkj08QBfMXTgsfkSzIpHF3zNQITW82haZmKLNTv5ClVzlzNs2gV5BU6CpAxMbgjPQljAqXtmcPh5Y6r7Z3OyAo2Owm6kxNwBVGC8Wp5c5ZOzHvY9KRf-pD_eoYOcZU8_OWxUDY14TTEyQ56qJmAcJkey-3izSP-tqIPJp-ACp43rTG8K6zI1G4gwuRCZiVGF9mvCRDinHS-jqOiQWElmTgu0M5uyKJdfm8BIgbluYyvO6WYZNgF64VaUDfcZYJtxmh7IDAW5_Hc-l9YVPMpTSVhOWHk4V6I7sB5LgkDUV5qAEFya3REcwh4j0E7XYn9hw8aPiYhyZTukbG025Q
            - name: FRONTEND_URL_AFTER_PAYMENT
              value: https://nightly.paylibero.ir/dashboard/trades